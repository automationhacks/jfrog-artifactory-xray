package backend.e2e;

import static com.google.common.truth.Truth.assertWithMessage;

import io.automationhacks.backend.core.object.Serialization;
import io.automationhacks.backend.core.utils.StringUtils;
import io.automationhacks.backend.domain.client.administration.repositories.local.CreateRepositoryClient;
import io.automationhacks.backend.domain.model.administration.repositories.CreateRepositoryRequest;

import org.testng.annotations.Test;

public class VulnerabilityScanByPolicyTest {
    @Test
    public void testVulnerabilityScanByPolicy() {
        CreateRepositoryClient createRepositoryClient = new CreateRepositoryClient();

        var repoName =
                "docker-local-%s".formatted(StringUtils.getRandomNumberBetweenRange(1, 1000));
        var createRepositoryRequest =
                CreateRepositoryRequest.builder()
                        .projectKey("")
                        .rclass("local")
                        .xrayIndex(true)
                        .packageType("docker")
                        .key(repoName)
                        .build();

        var response =
                createRepositoryClient.createRepository(
                        repoName, Serialization.serialize(createRepositoryRequest));
        assertWithMessage("Repository not created successfully for key: %s", repoName)
                .that(response.getStatusCode())
                .isEqualTo(200);
    }
}
